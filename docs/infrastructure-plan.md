# 인프라 전환 계획

> 최종 업데이트: 2026-02-11

사용량 증가에 따른 인프라 전환 가능성을 검토하고, 단계별 전환 전략을 정리한 문서.

---

## 현재 인프라 구성

| 구분 | 서비스 | 플랜 | 월 비용 | 용도 |
|------|--------|------|---------|------|
| 프론트엔드 | Vercel | Free (Hobby) | $0 | Next.js 정적/SSR 호스팅 |
| 백엔드 | Render | Starter ($7) | $7 | FastAPI + WebSocket 서버 |
| 데이터베이스 | Supabase | Free | $0 | PostgreSQL + pgvector + Auth + Storage |
| AI | OpenAI API | 종량제 | ~$1-3 | gpt-4o-mini (채팅), text-embedding-3-small (임베딩) |
| CI/CD | GitHub Actions | Free | $0 | 메뉴 스크래핑 (주 1회), NPC 상태 갱신 (일 1회) |
| **합계** | | | **~$8-10** | |

---

## 무료 티어 한도 및 병목 지점

### Vercel Free

| 항목 | 한도 | 초과 시 |
|------|------|---------|
| 대역폭 | 100GB/월 | Pro 전환 필요 ($20/월) |
| 서버리스 함수 실행 | 100GB-Hours | 초과 과금 |
| 빌드 | 6,000분/월 | 대기 |
| 상업적 사용 | 불가 | Pro 전환 필요 |

> 사내 서비스의 경우 Vercel Hobby 플랜의 상업적 사용 제한에 해당할 수 있음. 전직원 오픈 시 Pro 전환 또는 정적 호스팅 이전 검토 필요.

### Render Starter

| 항목 | 사양 | 리스크 |
|------|------|--------|
| CPU | 0.5 vCPU | RAG 파이프라인 동시 처리 시 병목 |
| RAM | 512MB | LangChain + 임베딩 모델 로딩 시 메모리 부족 가능 |
| 동시 접속 | 제한 없음 (성능 한도 내) | WebSocket 30명 + RAG 요청 동시 처리 시 응답 지연 |

> 30명 동시 접속 + RAG 요청이 몰리면 Starter 인스턴스로는 부족할 가능성 높음.

### Supabase Free

| 항목 | 한도 | 리스크 |
|------|------|--------|
| DB 용량 | 500MB | 지식베이스 문서 + 벡터 임베딩 + 채팅 이력 증가 시 초과 |
| Storage | 1GB | 캐릭터 이미지 135장 이미 사용 중 |
| 동시 접속 | 제한적 | Auth 요청 + DB 쿼리 + 벡터 검색 동시 처리 |
| 일시 정지 | 7일 비활성 시 자동 정지 | 운영 서비스에 치명적 |

> Free 플랜은 7일 비활성 시 자동 정지됨. 운영 환경에서는 Pro 전환 필수.

---

## 사용량 증가 시나리오

### 시나리오 A: 전직원 오픈 (30명, 활성 사용자 ~15명)

**예상 트래픽:**
- 일일 접속: ~15명
- NPC 채팅: 일 ~50-100회
- WebSocket 동시 접속: ~10-15명

**예상 비용 (현재 스택 유지):**

| 서비스 | 플랜 변경 | 월 비용 |
|--------|-----------|---------|
| Vercel | Pro | $20 |
| Render | Standard (1 CPU, 2GB) | $25 |
| Supabase | Pro | $25 |
| OpenAI API | 종량제 | $5-15 |
| **합계** | | **$75-85** |

### 시나리오 B: 적극 활용 (30명, 아바타 레벨 시스템 도입 후)

**예상 트래픽:**
- 일일 접속: ~25명
- NPC 채팅: 일 ~200-500회 (게이미피케이션 효과)
- 데이터 라벨링 미션 참여
- WebSocket 동시 접속: ~20명

**예상 비용 (현재 스택 유지):**

| 서비스 | 플랜 변경 | 월 비용 |
|--------|-----------|---------|
| Vercel | Pro | $20-50 (대역폭 초과 가능) |
| Render | Standard 이상 | $25-85 |
| Supabase | Pro | $25 |
| OpenAI API | 종량제 | $20-40 |
| **합계** | | **$90-200** |

> 종량제 기반이라 사용량에 비례해서 비용 증가. 예측이 어렵고, 스파이크 시 과금 폭증 가능.

---

## 전환 후보: AWS 고정 비용 구성

종량제의 비용 예측 불가 문제를 해결하기 위해, 고정 비용 인프라로의 전환을 검토.

### 구성안

| 구분 | AWS 서비스 | 사양 | 월 비용 |
|------|-----------|------|---------|
| 프론트엔드 | S3 + CloudFront | 정적 호스팅 + CDN | ~$1-3 |
| 백엔드 | EC2 t3.small | 2 vCPU, 2GB RAM | ~$17 |
| 데이터베이스 | Supabase Pro 유지 | PostgreSQL + Auth + Storage | $25 |
| AI | OpenAI API | 종량제 (변동 없음) | $10-30 |
| **합계** | | | **$53-75** |

### Vercel → S3 + CloudFront 전환 시 고려사항

| 항목 | Vercel | S3 + CloudFront |
|------|--------|-----------------|
| 배포 편의성 | Git push 자동 배포 | CI/CD 파이프라인 구축 필요 |
| SSR | 기본 지원 | Next.js standalone 빌드 필요 |
| 비용 예측 | 종량제 (변동) | 거의 고정 (~$1-3) |
| 커스텀 도메인 | 기본 제공 | Route 53 설정 필요 |

> Next.js를 `output: 'export'`로 정적 빌드하면 S3 호스팅이 가장 저렴. SSR이 필요한 경우 EC2에서 백엔드와 함께 서빙하는 방법도 가능.

### Render → EC2 전환 시 고려사항

| 항목 | Render Starter | EC2 t3.small |
|------|---------------|--------------|
| CPU | 0.5 vCPU | 2 vCPU |
| RAM | 512MB | 2GB |
| 월 비용 | $7 | ~$17 |
| 배포 | Git push 자동 | CI/CD 또는 수동 배포 |
| 관리 | 완전 관리형 | 직접 관리 (OS, 보안 패치) |
| 스케일링 | 플랜 변경 | Auto Scaling 설정 가능 |

> EC2는 성능 대비 비용이 저렴하지만, 서버 관리 부담이 증가함. 대안으로 ECS Fargate(컨테이너) 또는 AWS Lightsail($5-10)도 고려 가능.

---

## 단계별 전환 전략

### Phase 0 — 현행 유지 (현재)

- **대상:** 개발 및 내부 테스트 단계
- **비용:** ~$8-10/월
- **조건:** 활성 사용자 5명 이하

### Phase 1 — 유료 플랜 전환 (전직원 오픈 시)

- **트리거:** 전직원 대상 서비스 오픈
- **변경사항:**
  - Supabase Free → **Pro** ($25) — 자동 정지 방지, DB 용량 확보
  - Render Starter → **Standard** ($25) — RAM 2GB로 RAG 안정 처리
  - Vercel은 트래픽 보고 판단
- **비용:** ~$55-75/월
- **조건:** 활성 사용자 10-15명

### Phase 2 — AWS 부분 이전 (비용 최적화)

- **트리거:** Render/Vercel 과금이 월 $50 이상으로 증가하거나, 성능 병목 발생 시
- **변경사항:**
  - Render → **AWS EC2** (t3.small, ~$17) — 고정 비용, 성능 2배
  - Vercel → **S3 + CloudFront** (~$1-3) — 정적 빌드로 전환
  - Supabase Pro 유지 (Auth + Storage 직접 구현 비용 대비 유지가 효율적)
- **비용:** ~$53-75/월
- **조건:** 활성 사용자 15-25명

### Phase 3 — 풀 AWS 이전 (장기)

- **트리거:** Supabase 한도 초과 또는 더 세밀한 DB 제어 필요 시
- **변경사항:**
  - Supabase → **AWS RDS** (PostgreSQL + pgvector) + **Cognito** (Auth) + **S3** (Storage)
- **비용:** 구성에 따라 상이, 별도 산정 필요
- **주의:** Auth, Realtime, Storage를 직접 구현/관리해야 하므로 개발 공수 큼

---

## 비용 요약 비교

| 단계 | 월 비용 | 비고 |
|------|---------|------|
| Phase 0 (현재) | ~$8-10 | 무료 티어 + Render Starter |
| Phase 1 (전직원 오픈) | ~$55-75 | 유료 플랜 전환 |
| Phase 2 (AWS 부분 이전) | ~$53-75 | 고정 비용, 성능 향상 |
| Phase 3 (풀 AWS) | 별도 산정 | 완전 자체 관리 |

---

## AWS 계정 준비사항

- 회사 법인카드로 신규 AWS 계정 생성 권장
- IAM 사용자 분리 (루트 계정 직접 사용 금지)
- 예산 알림 설정 (AWS Budgets) — 월 한도 초과 시 알림
- 리전: `ap-northeast-2` (서울)

---

## 참고

- [Render 요금제](https://render.com/pricing) — 초 단위 종량제, Starter $7 / Standard $25
- [Vercel 요금제](https://vercel.com/pricing) — Hobby 무료 / Pro $20
- [Supabase 요금제](https://supabase.com/pricing) — Free / Pro $25
- [AWS EC2 요금](https://aws.amazon.com/ec2/pricing/) — t3.small 서울 리전 ~$17/월
